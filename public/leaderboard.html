<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grip Strength Challenge - Live Leaderboard</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #0a0a0a;
        }
        
        .leaderboard-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            min-height: 100vh;
            background: #0a0a0a;
            color: #fff;
        }
        
        .header {
            text-align: center;
            padding: 40px 20px 30px;
            border-bottom: 1px solid #222;
        }
        
        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 8px;
        }
        
        .header-subtitle {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .prizes-bar {
            display: flex;
            justify-content: center;
            gap: 50px;
            padding: 25px 20px;
            background: #111;
            border-bottom: 1px solid #222;
        }
        
        .prize-item {
            text-align: center;
        }
        
        .prize-place {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }
        
        .prize-amount {
            font-size: 1.4rem;
            font-weight: 700;
            color: #cc0000;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 15px 25px;
            font-size: 0.8rem;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid #222;
        }
        
        .content {
            padding: 20px;
        }
        
        .section-title {
            text-align: center;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #666;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #222;
        }
        
        .participant-row {
            display: flex;
            align-items: center;
            padding: 18px 20px;
            margin-bottom: 8px;
            background: #111;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
        }
        
        .participant-row:hover {
            background: #1a1a1a;
        }
        
        .rank-1 {
            border-left-color: #cc0000;
            background: linear-gradient(90deg, rgba(204, 0, 0, 0.1) 0%, #111 100%);
        }
        
        .rank-2 {
            border-left-color: #888;
            background: linear-gradient(90deg, rgba(136, 136, 136, 0.1) 0%, #111 100%);
        }
        
        .rank-3 {
            border-left-color: #8B4513;
            background: linear-gradient(90deg, rgba(139, 69, 19, 0.1) 0%, #111 100%);
        }
        
        .rank-other {
            border-left-color: #333;
        }
        
        .rank-number {
            width: 50px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            text-align: center;
        }
        
        .rank-1 .rank-number {
            color: #cc0000;
        }
        
        .rank-2 .rank-number {
            color: #888;
        }
        
        .rank-3 .rank-number {
            color: #8B4513;
        }
        
        .participant-info {
            flex: 1;
            padding-left: 15px;
        }
        
        .participant-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 3px;
        }
        
        .participant-company {
            color: #555;
            font-size: 0.85rem;
        }
        
        .participant-score {
            font-weight: 700;
            font-size: 1.3rem;
            text-align: right;
            min-width: 100px;
        }
        
        .rank-1 .participant-score {
            color: #cc0000;
            font-size: 1.5rem;
        }
        
        .rank-2 .participant-score {
            color: #888;
        }
        
        .rank-3 .participant-score {
            color: #8B4513;
        }
        
        .score-unit {
            font-size: 0.8rem;
            font-weight: 400;
            color: #555;
            margin-left: 4px;
        }
        
        .prize-tag {
            font-size: 0.7rem;
            color: #cc0000;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 3px;
        }
        
        .divider {
            text-align: center;
            padding: 20px;
            color: #444;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .scrollable-section {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #222;
            background: #0d0d0d;
        }
        
        .scrollable-section .participant-row {
            margin-bottom: 0;
            border-bottom: 1px solid #1a1a1a;
            padding: 14px 20px;
        }
        
        .scrollable-section .participant-name {
            font-size: 1rem;
        }
        
        .scrollable-section .participant-score {
            font-size: 1.1rem;
            color: #888;
        }
        
        .footer {
            text-align: center;
            padding: 30px 20px;
            border-top: 1px solid #222;
            margin-top: 30px;
        }
        
        .footer p {
            color: #444;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .loading {
            text-align: center;
            color: #555;
            padding: 60px 20px;
            font-size: 0.9rem;
        }
        
        .no-data {
            text-align: center;
            color: #444;
            padding: 80px 20px;
        }
        
        .no-data-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #666;
        }
        
        .no-data-subtitle {
            font-size: 0.9rem;
        }
        
        /* Mobile responsiveness */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.4rem;
                letter-spacing: 2px;
            }
            
            .prizes-bar {
                gap: 25px;
            }
            
            .prize-amount {
                font-size: 1.2rem;
            }
            
            .participant-row {
                padding: 15px;
            }
            
            .rank-number {
                width: 40px;
                font-size: 1.2rem;
            }
            
            .participant-name {
                font-size: 1rem;
            }
            
            .participant-score {
                font-size: 1.1rem;
                min-width: 80px;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }
        }
        
        /* Scrollbar styling */
        .scrollable-section::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollable-section::-webkit-scrollbar-track {
            background: #111;
        }
        
        .scrollable-section::-webkit-scrollbar-thumb {
            background: #333;
        }
        
        .scrollable-section::-webkit-scrollbar-thumb:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <div class="leaderboard-container">
        <div class="header">
            <h1>Grip Strength Challenge</h1>
            <p class="header-subtitle">Live Leaderboard</p>
        </div>
        
        <div class="prizes-bar">
            <div class="prize-item">
                <div class="prize-place">1st Place</div>
                <div class="prize-amount">$200</div>
            </div>
            <div class="prize-item">
                <div class="prize-place">2nd Place</div>
                <div class="prize-amount">$100</div>
            </div>
            <div class="prize-item">
                <div class="prize-place">3rd Place</div>
                <div class="prize-amount">$50</div>
            </div>
        </div>
        
        <div class="status-bar">
            <span id="totalCompetitors">0 Competitors</span>
            <span id="lastUpdated">Loading...</span>
        </div>
        
        <div class="content">
            <div id="leaderboardContent">
                <div class="loading">Loading results...</div>
            </div>
        </div>
        
        <div class="footer">
            <p>Updates automatically every 5 seconds</p>
            <p>Universal Truck Service</p>
        </div>
    </div>

    <script>
        let participants = [];
        let isRefreshing = false;
        
        document.addEventListener('DOMContentLoaded', function() {
            loadLeaderboard();
            setInterval(loadLeaderboard, 5000);
        });
        
        async function loadLeaderboard() {
            if (isRefreshing) return;
            isRefreshing = true;
            
            try {
                const response = await fetch('/api/leaderboard');
                participants = await response.json();
                
                updateStatusBar();
                displayLeaderboard();
                
            } catch (error) {
                console.error('Failed to load leaderboard:', error);
                displayError();
            }
            
            isRefreshing = false;
        }
        
        function updateStatusBar() {
            document.getElementById('totalCompetitors').textContent = 
                `${participants.length} Competitor${participants.length !== 1 ? 's' : ''}`;
            document.getElementById('lastUpdated').textContent = 
                `Updated ${formatTime(new Date())}`;
        }
        
        function displayLeaderboard() {
            const container = document.getElementById('leaderboardContent');
            
            if (participants.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-title">No Scores Recorded</div>
                        <div class="no-data-subtitle">Competition results will appear here</div>
                    </div>
                `;
                return;
            }
            
            const top10 = participants.slice(0, 10);
            const remaining = participants.slice(10);
            
            let html = `
                <div class="section-title">Top 10</div>
                ${top10.map((p, i) => createParticipantRow(p, i + 1)).join('')}
            `;
            
            if (remaining.length > 0) {
                html += `
                    <div class="divider">All Participants</div>
                    <div class="scrollable-section">
                        ${remaining.map((p, i) => createParticipantRow(p, i + 11, true)).join('')}
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function createParticipantRow(participant, position, isScrollable = false) {
            let rankClass = 'rank-other';
            let prizeTag = '';
            
            if (!isScrollable) {
                if (position === 1) {
                    rankClass = 'rank-1';
                    prizeTag = '<div class="prize-tag">$200 Prize</div>';
                } else if (position === 2) {
                    rankClass = 'rank-2';
                    prizeTag = '<div class="prize-tag">$100 Prize</div>';
                } else if (position === 3) {
                    rankClass = 'rank-3';
                    prizeTag = '<div class="prize-tag">$50 Prize</div>';
                }
            }
            
            return `
                <div class="participant-row ${rankClass}">
                    <div class="rank-number">${position}</div>
                    <div class="participant-info">
                        <div class="participant-name">${participant.name}</div>
                        <div class="participant-company">${participant.company || ''}</div>
                    </div>
                    <div class="participant-score">
                        ${participant.score}<span class="score-unit">lbs</span>
                        ${prizeTag}
                    </div>
                </div>
            `;
        }
        
        function displayError() {
            document.getElementById('leaderboardContent').innerHTML = `
                <div class="no-data">
                    <div class="no-data-title">Connection Error</div>
                    <div class="no-data-subtitle">Retrying automatically...</div>
                </div>
            `;
        }
        
        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }
    </script>
</body>
</html>
